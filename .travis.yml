language: node_js
node_js:
  - '8'
env:
  global:
    # Cozy-bot TOKEN
    - secure: "GkQtfqpxsEQiZIZ4vuD6eLxtzLRXHH9iyM3f1ca6sC+ojn6eQ3z3G8Ux8/+EZ2nMElb2MpwKE7ioGj2BwS+D4Qc2PtG8UtTltoId3dHGa3RgdWUYMiToxwtYv8SXupEtQ7rdD5QysmDC1NeEZdtrYphmd9rQ9O1Qg2sO6IB63+OrLfHoxZsO0QmghBpZ1Jt5UxAEMr8pftKCieXw39zTKBjcq+gBnGlymTbYrJJi/NB3bQXcDir6Km+HqbaqidL08mNp8rbzs0PFhL3L+Skuply9NpYUvh+L1eLf8/eKbuJR0+yhRotRqtaaKvAT7c+GoEKceL6MxJ37+nKbqTEfIDJhwzmx88wRR0hSimP8ZPaPHar/3HFNiLLrACx4P1R+1iJdbuowpxTtP9TMgiHWDo9hPXC/789k5FYt9Oa2VbcEiule7l6narUVan8GSIHWTUM7spKEHvOYSaGMJj91/xb7T/XUS+d3NfEgvZP5oRnGjUMmOaFNO2nabEeuUJXJQ5M18Iwid9256SUfYc/7aX9rcaqiKOiU1+7AGZ7eIYpJU1Zf3Cqr0buVoDVR5bi44rOJbLcKrco+RrRhuOAXfFkJHut9SrYp3+xFQ/xXSlXP2MEPMXXG8EqbeQGnpCZYk9NFWdPHzFGU8OBv9hlQ3FanwAYqWyh7CnndCvzxX00="
    # Cozy REGISTRY_TOKEN
    - secure: "CQ44ZVjPAIVRvGgMcduSAX4VmaOrzF3nrJXPFUsNQ2tMVVdaAlI1zTNkdfntqigZgz6Mpk9x+2FcA8qrkNzQ4cW0lPP9f5dBtSH1xetfpXDFKprW4bqzmhgXSXJFTOYxkChOBPmCYJr+Vv4XqDkv/dBEPdfRSgvVyd5YxHSd5HBU91rKyR+Hox7LTnhmlXleLIs11EQgp7RK+L28MBCtCqAa2niFlKKRlqupm2FSpZzxCh9qeY0wKCQzPE+QZUm4waJ1SUGKQwbzAfyOxu2O6rwzaTSknfdJoSX6AMxjRTWBC9c3VfUGM3wjVJIqMhiUj2FQhVIjiDyX/W60/q3UMC5WYzSvEDDfhnKCPwiUKSU7HvSxx9q2YP34evxKo7KPahz9zLlQZvW+GBMyI9hbMDBTALuQVVzhftsvqfrogyYhkEPviiYiVADWNxhacsbUjRA5svXnZvtmCPo7fLFwel/krgC5Z8AwAY0YxWjSHNVScUkieSDCrlxrC09vTtG60unt9gtXbD5ruUkDLWSUwHBv2p0WY1TdP+2Vlf3yYfBvEVbqi59AxG+T17bq7Xv3QZnkrwC+UOCNCeg+gHPv+fRpUaYWzCO4uaoY/nlJa7RulQFhGca3A//6xRo/KgWw9JJnOXJelNjE9oHCUu9xShotUZKOF+O93V/BRqs9ITo="

cache:
  yarn: true
  directories:
    - node_modules
script:
  - yarn lint
  - yarn build
deploy:
  # publish dev versions
  - provider: script
    repo: konnectors/bipandgo
    skip-cleanup: true
    script: DEPLOY_BRANCH=build && yarn deploy && yarn cozyPublish
    on:
      branch: master
  # publish on latest branch (will be removed when collect will use only the registry
  - provider: script
    repo: konnectors/bipandgo
    skip-cleanup: true
    script: DEPLOY_BRANCH=latest && yarn deploy
    on:
      branch: prod
  # publish stable versions and beta versions based on tags
  - provider: script
    repo: konnectors/bipandgo
    skip-cleanup: true
    script: DEPLOY_BRANCH=build && yarn deploy && yarn cozyPublish
    on:
      tags: true
